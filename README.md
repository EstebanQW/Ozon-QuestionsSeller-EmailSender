# Для чего этот скрипт

Этот скрипт предназначен для автоматического сбора вопросов о товарах с платформы Ozon (через личный кабинет селлера) и отправки их на указанный email.<br>
Скрипт предназначен для работы в паре с репозиторием (но можно использовать и отдельно) [Ozon-QuestionsSeller-EmailChecker]() (сначала формируются письма с вопросами, отправляются на почту сотрудника (или проект для обработки вопросов), который их обрабатывает. Затем скрипт `Ozon-QuestionsSeller-EmailChecker` проверяет почту и отправляет ответы по API. Скрипт создавался, чтобы ослеживать среднее время ответа, количество обработанных вопросов)

___

# Начало работы

* [Структура письма](#структура-письма)  
* [Установка зависимостей](#установка-зависимостей)  
* [Настройка параметров](#настройка-параметров)  
* [Запуск скрипта](#запуск-скрипта)  
* [Как работает скрипт](#как-работает-скрипт)  
* [Обработка ошибок](#обработка-ошибок)  
* [Пример использования](#пример-использования)  
* [Важные замечания](#важные-замечания)  
* [Пример вывода в консоль](#пример-вывода-в-консоль)  


## Структура письма
Каждое письмо содержит следующую информацию:

Текст вопроса: Текст вопроса, заданного покупателем.<br>
Ссылка на товар OZON: Ссылка на страницу товара.<br>
Название бренда: Название бренда или торговой сети.<br>
ID вопроса: Уникальный идентификатор вопроса.<br>
Дата поступления вопроса: Дата и время, когда вопрос был опубликован.<br>
Артикул на OZON: Артикул товара на Ozon.<br>
Артикул наш сайт: Артикул товара на вашем сайте (если доступен).<br>
Название товара: Название товара, к которому относится вопрос.<br>



## Установка зависимостей

Перед запуском скрипта убедитесь, что у вас установлены все необходимые библиотеки. Для этого выполните команду:
```
pip install requests boto3
```


## Создание бакета с Cookie 

Бакет создается, чтобы не обновлять куки в каждом скрипте, а обновлять только содержимое файла в бакете (здесь обновление куки происходит внутри функции `change_cookie_bucket`)<br>
О том, как создать бакет и настроить к нему доступ лучше почитать в документации [Yandex Object Storage](https://yandex.cloud/ru/docs/storage/operations/buckets/create)<br>
Также есть видео от Яндекса, в котором всё достаточно подробно объясняется - [Используем Yandex Cloud Functions в работе с Object Storage](https://www.youtube.com/watch?v=_d-EPZ-X_Qo&ab_channel=YandexCloud)<br>
Если вы запускаете только один скрипт с куки Ozon, то можно обойтись без бакета и указывать куки напрямую в скрипте переменной.


## Настройка параметров

В начале скрипта находятся переменные, которые необходимо настроить перед запуском:<br>
`bucket_name`: Название бакета в Yandex Object Storage.<br>
`file_name`: Название файла с куки в бакете.<br>
`AWS_ACCESS_KEY_ID`: Key ID для доступа к бакету.<br>
`AWS_SECRET_ACCESS_KEY`: Key для доступа к бакету.<br>
`region`: Регион бакета (обычно "ru-central1").<br>
`company_id`: Уникальный идентификатор компании на Ozon. Его можно найти в URL страницы компании на Ozon. Например, для URL https://www.ozon.ru/seller/ooo-mebelnaya-fabrika-volzhanka-1234/products/?miniapp=seller_1234 идентификатор компании — 1234.<br>
`fromaddr`: Почта, с которой будет отправляться письмо.<br>
`mypass`: Пароль от почты для внешних приложений.<br>
`toaddr`: Почта, на которую будут отправляться письма.<br>
`questions_sum`: Количество запросов, которые скрипт выполнит для сбора вопросов. Один запрос возвращает до 10 вопросов.<br>
`cookie`: Актуальные куки для авторизации на Ozon.

## Запуск скрипта
После настройки параметров запустите скрипт:
```
python main.py
```

## Как работает скрипт

* Скрипт отправляет запросы к API Ozon для получения вопросов.
* Каждый запрос возвращает до 10 вопросов.
* Полученные вопросы отправляются на указанный email.
* Если запросы проходят успешно, скрипт обновляет куки в Yandex Object Storage.
* Скрипт останавливается после выполнения заданного количества запросов (`questions_sum`).


## Обработка ошибок
Если скрипт сталкивается с ошибкой (например, проблемы с сетью или API), он делает до 10 повторных попыток с задержкой между ними.<br>
В случае успешного завершения скрипт выводит сообщение "Все сообщения(кейсы) отправлены.".<br>

## Пример использования
Установите зависимости.<br>
Настройте параметры (bucket_name, file_name, AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, region, company_id, fromaddr, mypass, toaddr, questions_sum, cookie).<br>
Запустите скрипт.<br>
После завершения работы скрипта проверьте почту, на которую отправлялись письма.<br>

## Важные замечания
Убедитесь, что куки актуальны. Если куки истекли, скрипт не сможет получить данные.<br>
Не указывайте слишком большое значение для questions_sum, чтобы избежать блокировки со стороны Ozon.<br>
Скрипт делает паузы между запросами, чтобы снизить нагрузку на сервер Ozon.<br>

## Пример вывода в консоль
```
cookie: "your_cookie_here"
cases: "10"
Отправляю запрос на сервер OZON для получения вопросов. Запрос 1 из 10.
Время выполнения программы: 00:00:15
Начинаю отправку сообщения(кейса) на email example2@mail.ru.
Сообщение отправлено. Осталось отправить сообщений(кейсов): 9шт.
Время выполнения программы: 00:00:20
...
...
...
Все сообщения(кейсы) отправлены.
Время выполнения программы: 00:01:30
```